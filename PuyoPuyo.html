<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>PuyoPuyo</title>
    <script>
    //  pour tout savoir sur l'optimisation des performances dans les canvas
    var context = null;

    // clic sur la zone de jeu (coordonnées relatives au canvas)
    var clic = { x: 0, y: 0 };

    /**
    *Les constantes, les variables et les structures de PuyoPuyo
    */
    var position = {x: 0, y:0}; //position dans le tableau
    var puyo = {couleur: "", groupe: -1, check: false}; //structure représentant un puyo

    var lgn = 14;
    var cln = 8;
    var score = 0; //score du joueur
    var detection = true; //met fin à la destruction des puyos dans le jeu
    var chaine = 0; //compte le nombre de chaine pour le score
    var tabPuyo = []; //tableau de jeu

    // initialisation (appelée au chargement du corps du document <body onload="init">)
    init = function() {
        // instanciation de la variable globale contenant le contexte
        context = document.getElementById("cvs").getContext("2d");
        context.width = document.getElementById("cvs").width;
        context.height = document.getElementById("cvs").height;

        // on associe au document des écouteurs d'événements
        document.addEventListener("keydown", captureAppuiToucheClavier) // 2 écouteurs pour le clavier (appui/relâchement d'une touche)
        document.addEventListener("keyup", captureRelacheToucheClavier) // on associe au document un écouteur d'événements souris
        document.addEventListener("click", captureClicSouris)
        // --> ces événements vont appeler les fonctions captureXYZ définies après.
        // initialisation du tableau
        initTabPuyo(tabPuyo);

        // lancement de la boucle de jeu
        boucleDeJeu();
    }

    //initialisation de notre tableau de puyo tabPuyo
    initTabPuyo = function(tabPuyo) {

      for(var i=0;i<lgn; i++){
        tabPuyo.push([]);
        tabPuyo[i].push("I");
        for(var j=0; j<cln-2; j++){
          tabPuyo[i].push("N");
        }
        tabPuyo[i].push("I");
      }

      tabPuyo.push([]);
      for(var j=0; j<cln; j++){
        tabPuyo[i].push("I");
      }

      console.table(tabPuyo);

    }

    boucleDeJeu = function() {
        // mise à jour de l'état du jeu
        update(Date.now());
        // affichage de l'état du jeu
        render();
        // rappel de la boucle de jeu
        // requestAnimationFrame est une fonction JS servant à pré-calculer le prochain affichage
        requestAnimationFrame(boucleDeJeu);
    }


    /**
     *  Mise à jour de l'état du jeu
     *  @param  d   date courante
     */
    update = function(d) {

    }


    /**
     *  Fonction réalisant le rendu de l'état du jeu
     */
    render = function() {
        // effacement de l'écran

    }


    /**
     *  Fonction appelée lorsqu'une touche du clavier est appuyée
     *  Associée à l'événement "keyDown"
     */
    captureAppuiToucheClavier = function(event) {
    }

    /**
     *  Fonction appelée lorsqu'une touche du clavier est relâchée
     *  Associée à l'événement "keyUp"
     */
    captureRelacheToucheClavier = function(event) {
    }

    /**
     *  Fonction appelée lorsqu'une touche du clavier est relâchée
     *  Associée à l'événement "click"
     */
    captureClicSouris = function(event) {
        // calcul des coordonnées de la souris dans le canvas
    }

    </script>
</head>

<body onload="init()">

    <canvas id="cvs" width="800" height="600" style="margin: 10px auto; border: solid 1px #000;"></canvas>

</body>

</html>
